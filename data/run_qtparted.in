#!/bin/sh

getmousetype()
{
	local mymouse
	echo "Please, choose your mouse type"
	echo "0) autodetect"
	echo "1) usb"
	echo "2) serial"
	echo "3) ps/2"
	echo "4) none"

	read -p "Your mouse selection: " mymouse

	if [ "$mymouse" = "0" ]
	then
		echo "autodetect mouse"
		export QWS_MOUSE_PROTO=Auto
	elif [ "$mymouse" = "1" ]
	then
		echo "USB mouse"
		export QWS_MOUSE_PROTO=MouseMan:/dev/input/mouse0
	elif [ "$mymouse" = "2" ]
	then
		echo "Serial mouse"
		export QWS_MOUSE_PROTO=Microsoft:/dev/ttyS0
	elif [ "$mymouse" = "3" ]
	then
		echo "PS/2 mouse"
		export QWS_MOUSE_PROTO=IntelliMouse:/dev/psaux
	else
		echo "No mouse"
		export QWS_MOUSE_PROTO=
	fi
}

# Warn if frame buffer not running
#if [ ! -f /dev/fb0 ] ; then
#  echo "You need the Frame Buffer in order to run QtParted"
#  echo "Cannot continue."
#  exit 1
#fi

# defines environment variables
export QTDIR=@PATH_QTDIR@
export LD_LIBRARY_PATH="$QTDIR/lib:$LD_LIBRARY_PATH"
export PATH=/sbin:/usr/sbin:/bin:/usr/bin:$PATH
getmousetype

# show environment variables
echo "QTDIR=$QTDIR"
echo "LD_LIBRARY_PATH=$LD_LIBRARY_PATH"

if ! test -e /proc/fb; then 
   echo "Frame buffer not loaded, cannot run QT/Embedded." 
   echo "You may need to choose a different vga video mode "
   echo "at the boot prompt."
   exit 1
fi

# disable kernel messages
echo 0 > /proc/sys/kernel/printk

# run qtparted
qtparted -qws 2> /dev/null
clear
